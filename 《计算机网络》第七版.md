《计算机网络》第七版



# 一、概述

* 三大网络：电信网络、有线电视网络和计算机网络，现在是**三网融合**。
* 网络把许多计算机连接到一起，而互联网则把许多网络通过路由器连接到一起。与网络相连的计算机常称为主机。
* 现在的互联网已不是某个组织所拥有，而是世界上大大小小的ISP所共同拥有的，这就是互联网也称为“网络的网络”的原因。
* 速率：网络技术中的速率指的是数据的传送速率，也称为数据率或比特率，速率的单位是bit/s。
* 带宽：某信道允许通过的信号频带范围。
* 互联网现在采用存储转发的**分组交换**技术，以及三层ISP结构。
* 互联网按工作方式可划分为边缘部分与核心部分。主机在网络的边缘部分，其作用是进行信息处理。路由器在网络的核心部分，其作用是按存储转发方式进行分组交换。
* 按作用范围的不同，计算机网络分为广域网WAN、城域网MAN、局域网LAN和个人区域网PAN。
* 五层协议的体系结构由应用层、运输层、网络层、数据链路层和物理层组成。运输层最重要的协议是TCP和UDP协议，而网络层最重要的协议是IP协议。



# 二、物理层

## 2.1 有关信道的几个基本概念

1. 单工通信：只能由一个方向的通信而没有反方向的交互，如无线电广播。
2. 半双工通信：通信的双方都可以发送消息，但不能双方同时发送。
3. 全双工通信：通信的双方都可以同时发送和接收消息。
4. 基带信号：来自信源的信号，基带信号往往包含较多的低频成分，甚至由直流成分，而许多信道并不能传输这种低频成分和直流分量，于是需要对基带信号进行**调制**。
5. 正交振幅调制：为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调制方法。
6. 奈式准则：在任何信道中，码元传输的速率是有上限的，传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的判决成为不可能。
7. 香农公式:信道的带宽或信道中的信噪比越大，信息传输的极限速率就越高。
8. 带宽：信号具有的频带宽度，允许信号通过的频率范围。

## 2.2 物理层下面的传输媒介

1. 双绞线：把两根互相绝缘的铜导线并排放在一起，然后用规则的方法绞合起来。模拟传输和数字传输都可以使用双绞线，通信距离一般为几到十几公里。使用双绞线最多的地方就是电话系统。
2. 同轴电缆：由内导体铜芯线、绝缘层和网状编织的外导体屏蔽层组成。目前同轴电缆主要用在有线电视网的居民小区中。
3. 光缆：利用光导纤维传递光脉冲来进行通信，原理是光的全反射。
4. 多模光纤：存在多条不同角度入射的光线在一条光纤中传输。光脉冲在多模光纤中传输会逐渐展宽，造成失真，因此多模光纤只适合短距离传输。
5. 单模光纤：光纤的直径减小到只有一个光的波长，则光纤就像一根波导那样，可以使光线一直向前传播，而不会产生多次反射。单模光纤的光源要使用昂贵的半导体激光器，而不能使用廉价的发光二极管。
6. 微波通信：
   * 微波波段频率很高，其频段范围也很宽，因此其通信信道的容量很大。
   * 微波接力通信相邻之间必须直视，不能由障碍物。
7. 卫星通信：
   * 通信距离远，且通信费用与通信距离无关。
   * 频带很宽，通信容量大，信号受到的干扰小。
   * 具有较大的时延。
   * 保密性相对较差。

## 2.3 信道复用技术

1. 如果在发送端使用一个复用器，就可以让大家合起来使用一个共享信道进行通信。在接收端再使用分用器，把合起来传输的信息分别送到相应的终点。

### 2.3.1 （统计）时分复用

* 所有用户在不同的时间占用同样的频带宽度。
* 当某用户暂时无数据发送时，在时分复用帧中分配给该用户的时隙只能出于空闲状态，其他用户即使一直有数据要发送，也不能使用这些空闲的时隙，造成了信道利用率不高的结果。
* **统计时分复用**是一种改进的时分复用，它能明显地提高信道的利用率。统计时分复用使用STDM帧来传送复用的数据，但每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后**集中器**按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中。对没有数据的缓存就跳过去。当一个帧的数据放满了，就放出去。**因此，STDM帧不是固定分配时隙，而是按需动态地分配时隙。**这样可以提高信道的利用率。
* **集中器**能够正常工作的前提是假定各用户都是间歇地工作。
* 由于STDM帧中的时隙并不是固定地分配给某个用户，因此在每个时隙中还必须有用户的地址信息，这是统计时分复用必须要有的，且是不可避免的一些开销。

### 2.3.2 波分复用

* 光的频分复用。
* 人们经常在一根光缆中放入尽可能多的光纤，然后对每一根光纤使用密集波分复用技术。

### 2.3.3 码分复用（CDM）

* 一种共享信道的方法，更常用码分多址（CDMA）来描述。
* 每一个用户可以在同样的时间使用同样的频带进行通信。由于各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。



## 2.4 带宽接入技术

### 2.4.1 ADSL技术（非对称数字用户线）

* 用数字技术对现有的模拟电话用户线进行改造，使它能够承载带宽数字业务。
* 由于用户上网时主要是从互联网下载各种文档，而向互联网发送的信息量一般都不太大，因此，ADSL的下行带宽都远远大于上行带宽。

### 2.4.2 光纤同轴混合网（HFC网）

* 在目前覆盖面很广的有线电视网的基础上开发的一种居民宽带接入网，除可传送电视节目外，还能提供电话、数据和其他带宽交互型业务。
* 为了提高传输的可靠性和电视信号的质量，HFC网把原有线电视网中的同轴电缆主干部分改换为光纤。光纤从头端连接到光纤结点。在光纤结点光信号被转换为电信号，然后通过同轴电缆传送到每个家庭。
* 要使现在的模拟电视能够接收数字电视信号，需要把一个叫做**机顶盒**的设备连接在同轴电缆和电视机之间。

### 2.4.3 FTTx技术

* FTTx表示多种带宽光纤接入方式，表示Fiber to the ....(FTTH:fiber to the home.).



# 三、数据链路层

* 数据链路层的点对点信道：PPP协议；广播信道：CSMA/CD协议。
* 数据链路层的三个基本问题：封装成帧、透明传输和差错检测。
* 适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合。
* 路由器在转发分组时使用的协议栈只有下面的三层：数据进入路由器后要先从物理层上到网络层，在转发表中找到下一跳的地址后，再下到物理层转发出去。

## 3.1 使用点对点信道的数据链路层

1. 数据链路层把网络层交下来的数据**封装成帧**发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。在互联网中，网络层协议数据单元就是IP数据报。
2. 数据链路层不必考虑物理层如何实现比特传输的细节。
3. 三个基本问题：封装成帧、透明传输和差错检测。

### 3.1.1 封装成帧

* 一段数据的前后分别添加首部和尾部。首部和尾部的一个重要作用就是进行帧界定。
* **最大传输单元（MTU）**：每一种链路层协议都规定了所能传送的帧的**数据部分长度上限。**
* 假定发送端在尚未发送完一个帧时突然出现故障，中断了发送。但随后很快又恢复正常，于是重新从头开始发送刚才未发送完的帧。由于使用了帧界定符，接收端就知道前面收到的数据是个不完整的帧。

### 3.1.2 透明传输

* 传输的数据中任何8比特的组合一定不允许和用作帧界定的控制字符的比特编码一样，否则就会出现帧界定错误。
* **透明**是一个很重要的术语：表示某一个实际存在的食物看起来却好像并不存在一样。
* 透明传输设法使数据中可能出现的控制字符，在接收端不被解释为控制字符。具体做法是：发送端的数据链路层在数据中出现控制字符"SOH"和“EOT”的前面插入一个转义字符“ESC”。而在接收端的数据链路层在把数据送往网络层之前删除这个插入的转义字符。**这种方法成为字节填充或字符填充。**如果转义字符也出现在数据中，那么解决办法仍然是在转义字符的前面插入一个转义字符。**因此，当接收端收到连续的两个转义字符时，就删除其中前面的一个。**

### 3.1.3 差错检测

* **误码率**：传输错误的比特占所传输比特总数的比率。
* 误码率与信噪比有很大的关系。如果设法提高信噪比，就可以使误码率减小。实际的通信链路并非是理想的，他不可能使误码率下降到零。
* **目前在数据链路层广泛使用了循环冗余检验（CRC）的检错技术。**
* CRC运算就是在数据M的后面添加供差错检测用的n位冗余码，然后构成一个帧发送出去。**在所要发送的数据后面增加了n位冗余码，虽然增大了数据传输的开销，但却可以进行差错检测。**
* 为了进行检错而添加的冗余码常称为**帧检验序列FCS**。
* 循环冗余检验CRC和帧检验序列FCS并不是同一个概念。CRC是一种检错方法，而FCS是添加在数据后面的冗余码，在检错方法上可以选用CRC，但也可以不选用 CRC。
* **在数据链路层，发送端帧检验序列FCS的生成和接收端CRC检验都是由硬件完成的，不会延误数据传输。**
* 可靠传输：数据链路层的发送端发送什么，在接收端就收到什么。传输差错可分为两大类：一类就是最基本的比特差错，另一类传输差错则更为复杂（帧丢失、帧重复或帧失序）。
* 对于通信质量良好的有线传输链路，数据链路层协议不使用确认和重传机制，既不要求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要进行改正，那么改正差错的任务就由上层协议来完成。对于通信质量较差的无线传输链路，数据链路层协议使用确认和重传机制，数据链路层向上提供可靠传输的服务。**实践证明：这样做可以提高通信效率。**

## 3.2 点对点协议PPP

* 在通信线路质量较差的年代，在数据链路层使用可靠传输协议曾经是一个好办法（**高级数据链路控制（）HDLC**）。但现在HDLC已经很少使用了，现在用的更多地是点对点协议PPP。
* 互联网用户通常要连接到某个ISP才能接入到互联网。**PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议。**
* PPP协议设计时必须考虑以下多方面的需求：
  1. **简单**：设计时，把复杂的部分放在TCP协议中，而IP则相对简单，只提供不可靠的数据报服务。在这种情况下，数据链路层没有必要提供比IP协议更多地功能。因此，对数据链路的帧，不需要纠错，不需要顺序控制，不需要流量控制。**接收方每收到一个帧，就进行CRC校验。如果CRC校验正确，就留下这个帧，反之则抛弃这个帧。**
  2. **封装成帧**：PPP协议必须规定特殊字符作为帧界定符。
  3. **透明性**：如果数据遇到和**帧界定符**一样的比特组合，就采取有效地措施来解决这个问题。
  4. **多种网络层协议**：能够在同一条物理链路上同时支持多种网络层协议。同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。
  5. **多种类型链路**：除了要支持多种网络层的协议外，PPP还必须能够在多种类型的链路上运行（串行的、并行的、同步的、异步的、低速的、高速的、电的、光的、交换的、非交换的）。
  6. **差错检测**：立即丢弃有差错的帧。
  7. **检测连接状态**：自动检测链路是否出于正常工作状态。
  8. **最大传送单元**：PPP协议必须对每一种类型的点对点链路设置最大传送单元MTU的标准默认值。**MTU是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长度。**
  9. **网络层地址协商**：使通信的两个网络层的实体能够通过协商知道或配置彼此的网络层地址。
  10. **数据压缩协商**：PPP协议并不要求数据压缩算法进行标准化。
* **在TCP/IP协议中，可靠传输由TCP协议负责，因此数据链路层的PPP协议不需要进行纠错，不需要设置序列号，也不需要进行流量控制。**
* PPP协议**只支持点对点的链路通信、只支持全双工链路。**

### 3.2.1 PPP协议的组成（三部分）

1. 一个将IP数据报封装到串行链路的方法。IP数据报就是PPP帧中的信息部分，这个信息部分受MTU的限制。
2. 一个用来建立、配置和测试数据链路连接的链路控制协议LCP（Link Control Protocol）。
3. 一套网络控制协议NCP，其中的每一个协议支持不同的网络层协议。

### 3.2.2 PPP协议的帧格式

1. PPP帧的首部有是个字段，尾部有两个字段。
2. PPP帧的首部分别为：**0x7E, 0xFF, 0x03, 协议字段。**
3. 当**协议字段**为0x0021的时候，PPP帧的信息字段就是IP数据报。当**协议字段**为0xC021的时候，PPP帧的信息字段就是LCP的数据。当**协议字段**为0x8021的时候，PPP帧的信息字段就是控制数据。
4. 尾部的第一个字段是使用CRC的帧校验序列FCS。
5. **字节填充**：当**信息字段**中出现和**标志字段**一样的比特组合（0x7E）时，就必须采取一些措施使**和标志字段一样的比特组合不出现在信息字段中。**字节填充使得链路上的信息字节数超过了原来的信息字节数。在接收端载进行相反的变换，就能正确的恢复出原有的信息。
6. **零比特填充**：PPP协议在使用同步传输时（**一连串的比特连续发送而不是逐个字符地发送**），采用零比特填充的方法来实现**透明传输**。

### 3.2.3 PPP协议的工作状态

* 用户拨号接入ISP之后，电脑向ISP发送一系列链路控制协议LCP分组，以便建立LCP连接。接着进行网络层配置，网络控制协议NCP给新接入用户分配一个临时IP地址。

* 用户通信完毕，NCP释放网络层连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接，最后释放物理层连接。PPP的状态包括：

  1. **链路静止**：用户电脑和ISP的路由器之间不存在物理层连接。
  2. **链路建立**：路由器检测到调制解调器发出的载波信号，双方建立了物理层连接。这时LCP开始协商一些配置选项，发送PPP协议的LCP配置请求帧。
  3. **鉴别状态**：发起通信的一方发送身份标识符和口令进行鉴别。若身份鉴别失败进入**链路终止**，若鉴别成功进入**网络层协议**状态。
  4. **网络层协议状态**：PPP链路两端的网络控制协议NCP根据网络层的不同协议相互交换网络层特定的控制分组。**PPP协议两端的网络层可以运行不同的网络层协议，但仍然可以使用同一个PPP协议进行通信。**
  5. **链路打开**：网络层配置完毕之后，链路就可以进行数据通信。链路的两个PPP端点可以彼此向对方发送分组。两个PPP端点还可以发送回送请求LCP分组和回送回答LCP分组，以检查链路状态。

  传输结束后，链路的一端发送**终止请求LCP分组**请求终止链路连接，在收到对方发来的**终止确认LCP分组**之后，链路转为**链路终止**状态。**当调制解调器的载波停止后，回到链路静止状态。**

* **从设备之间无链路开始，到先建立物理链路，再建立链路控制协议LCP链路。经过鉴别后再建立网络控制协议NCP链路，才能交换数据。由此可见，PPP协议已不是纯粹的数据链路层的协议，它还包含了物理层和网络层的内容。**



## 3.3 使用广播信道的数据链路层

* 共享信道要着重考虑的问题是**如何使众多用户能够合理而方便地共享通信媒体资源**。在技术上有两种方法：
  1. 静态划分信道：频分复用、时分复用、波分复用和码分复用。代价较高，不适合局域网。
  2. 动态媒体接入控制：多点接入，信道并非在用户通信时固定分配给用户。又分为以下两大类：
     * 随机接入：如果恰巧有两个用户在同一时刻发送消息，那么在共享媒体上就要发生碰撞，是的这些用户都会发送失败。
     * 受控接入：**分散控制的令牌环局域网**和**集中控制的多点线路探询**。

### 3.3.1 适配器（网卡）的作用

* 在网络是适配器上装有处理器和存储器（包含RAM和ROM），**适配器和局域网之间通过电缆或双绞线以串行传输方式进行。而适配器和计算机主板上的I/O总线以并行方式传输。**
* 适配器需要实现以太网协议。
* **计算机的硬件地址就在适配器的ROM中，而计算机的IP地址则在计算机的储存器中。**



### 3.3.2 CSMA/CD协议

* 总线的特点是：当一台计算机发送数据时，总线上的所有计算机都能检测到这个数据。这就是广播通信。

* 在发送数据帧时，在帧的首部写明接收站的地址。仅当数据帧中的目的地址与**适配器ROM**中存放的硬件地址一致时，该适配器才接收这个数据。**适配器对不是发送给自己的数据就丢弃。**

* 为了通信方便，以太网采取了以下两种措施：

  1. 采用较为灵活的无连接方式，不必先建立连接就可以直接发送数据。不进行编号，也不要求对方发回确认。**以太网提供的服务是尽最大努力交付，即不可靠的交付。对有差错的帧是否需要重传则由高层来决定。**如果高层确认要重传，**但以太网并不知道这是重传帧，而是当做新的数据帧来发送。**以太网以太网使用的是CSMA/CD，意思是载波监听多点接入/碰撞检测。
  2. 采用曼切斯特编码。当出现一长串的连1或连0时，接收端就利用电压的转换很方便地把同步信号提取出来。缺点就是频带宽度比原始的基带信号增加了一倍。

* CSMA/CD的特点：

  1. **多点接入**：总线型网络，协议的本质是**载波监听**和**碰撞检测**。
  2. **载波监听**：**不管在发送前，还是发送中，每个站都必须不停地检测信道。**如果检测出已经有其他站在发送，则自己就暂时不许发送数据，必须要等到信道变为空闲时才能发送。
  3. **碰撞检测**：**边发送边监听。**当适配器检测到信号电压变化幅度超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。一旦发生了碰撞，适配器就立即停止发送，免得继续进行无效的发送，白白浪费网络资源。

  * **在使用CSMA/CD协议时，一个站不可能同时发送和接收（但必须边发送边监听）。**因此使用CSMA/CD协议的以太网不可能进行全双工通信而只能进行**半双工通信。**
  * 适配器每发送一个新的帧，就要执行一次CSMA/CD算法。适配器对过去发生过的碰撞并无记忆功能。
  * **以太网规定了一个最短帧长64字节，如果要发送的数据非常少，就必须加入一些填充字节，使帧长度不小于64字节。**
  * **如果发生碰撞，就一定是在发送的强64字节之内。**由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于64字节，因此**凡是长度小于64字节的帧都是由于冲突而异常中止的无效帧。**
  * **强化碰撞**：发送数据的站一旦发现了碰撞，除了立即停止发送数据外，还要再继续发送一个32比特或48比特的人为干扰信号，以便让所有用户都知道现在已经发生了碰撞。
  * CSMA/CD协议的要点：
    1. 准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部，组成以太网帧，放入适配器缓存中。**发送之前先检测信道。**
    2. 检测信道：以太网规定了帧间最小间隔9.6μs，相当于96比特的时间。若检测到信道忙，则应不停地检测，一直等待信道转为空闲。**若检测到信道空闲，并在96比特时间内信道保持空闲，就发送这个帧。**
    3. 在发送的过程中不停地检测信道，即网络适配器要**边监听边发送。**在争用期内一直未检测到碰撞，则发送成功，**回到第1步**。若检测到碰撞，立即停止发送数据，执行指数退避算法，回到步骤2，继续检测信道。若重传16次仍然不能成功，则停止重传并向上报错。
  * 以太网每发送完一帧，一定要把已发送的帧暂时保留一下，如果在争用期内检测出碰撞，那么还要在推迟一段时间后把这个保留的帧重传一次。



### 3.3.3 使用集线器的星型拓扑

* 星型拓扑的中心使用集线器。双绞线以太网和集线器总是配合使用的。双绞线的两端使用RJ-45插头。
* **10BASE-T双绞线以太网的出现，是局域网发展史上的一个非常重要的里程碑。从此以太网的拓扑就从总线型变为星型，而以太网也就值局域网中占据了统治地位。**
* **使用集线器的以太网在逻辑上仍然是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议。**网络中各站必须竞争对传输媒体的控制，并且在同一时刻至多只允许一个站发送数据。
* 一个集线器有许多接口。**因此，一个集线器很想多接口的转发器。**
* **集线器工作在物理层**。每个接口仅仅简单地转发比特，**不进行碰撞检测**。若两个接口同时有信号输入（即发生碰撞），那么所有的接口都将收不到正确的帧。
* 集线器采用了专门的芯片，进行自适应串音回波抵消。
* 当扣除碰撞所造成的信道损失后，以太网的总信道利用率并不能达到100%。

### 3.3.4 以太网的MAC层

* **名字指出我们所要寻找的那个资源，地址指出那个资源在何处，路由告诉我们如何到达该处。**
* **严格地讲，名字应当与系统所在地无关。**
* 48位的MAC地址，固化在适配器的ROM中。
* MAC地址也叫作硬件地址或物理地址，实际上就是适配器地址或适配器标识符。当这块适配器插入到某台计算机后，适配器上的标识符就成为这台计算机的MAC地址。
* 所有的适配器都至少能够识别**单播**和**广播**帧。**当操作系统启动时，它就把适配器初始化，使适配器能够识别某些多播地址。**
* 以太网MAC帧格式：目的地址\6、源地址\6、类型\2、数据部分\46-1500、FCS\4。
* 当数据字段的长度小于46字节,MAC层就会在数据字段的后面加入一个整数字节的填充字段，以保证以太网的MAC帧长度不小于64字节。**在接收端，MAC子层在去掉首部和尾部之后，就把数据字段和填充字段一起交给上层协议。**
* MAC子层在将MAC帧向下传递到物理层的时候会在帧的前面添加8字节，由硬件生成。这个添加的字节叫做**前同步码**，作用是使接收端的适配器在接收MAC帧时能够迅速调整时钟频率，使接收端和发送端时钟同步。
* **在以太网传送数据时是以帧为单位传送的。以太网在传送帧时，各帧之间还必须有一定的间隙。因此，接收端只要找到帧开始界定符，其后面的连续到达的比特流就都属于同一个MAC帧。可见以太网不需要帧结束界定符，也不需要使用字节插入来保证透明性。**



## 3.4 扩展的以太网

* 两个网段使用一个转发器连接起来，这种网络在网络层看起来仍然是一个网络。
* 扩展以太网更常用的是网桥。网桥对收到的MAC帧的目的地址进行转发和过滤。根据此帧的目的MAC地址，查找网桥中的地址表，然后确定将该帧转发到哪一个接口，或者把它丢弃。1990年问世的**交换式集线器**，很快就淘汰了网桥。**交换式集线器常称为以太网交换机，这种交换机工作在数据链路层。**

### 3.4.4 以太网交换机的特点

1. 本质上是一个多接口网桥。以太网交换机的每个接口都直接与一个单台主机或另一个以太网交换机相连，并且一般都工作在全双工方式。**以太网交换机还具有并行性，即能同时连通多对接口，使多对主机能同时通信。相互通信的主机都是独占传输媒体，无碰撞地传输数据。**
2. 以太网交换机是一种即插即用的设备，其内部的帧交换表是**通过自学习算法自动逐渐建立起来。**以太网交换机使用了专门的交换接口芯片，**用硬件转发**，转发速率比使用软件转发的网桥快很多。
3. 虽然许多以太网交换机对收到的帧采用存储转发方式进行转发，但也有一些交换机采用直通的交换方式。**直通交换不必把整个数据帧先缓存下来再进行转发处理，而是在接收到帧的同时就立即按数据帧的目的MAC地址决定该帧的转发接口，提高了准发速度。**这种交换机内部采用基于硬件的交叉矩阵，交换时延就非常小。
4. 交换机的自学习功能。交换表中的每个项目都设有一定的时间。过期的项目都将被自动删除。这样可以保证交换表中的数据都符合当前网络的实际状况。**为了解决转发时兜圈子问题，IEEE的802.1D标准制定了生成树协议。**其特点时不改变网络的实际拓扑，但在逻辑上切断某些链路，使得一台主机到其他主机的链路无环路。
5. **总线以太网使用CSMA/CD协议，以半双工通信。而以太网交换机不使用共享总线，不使用CSMA/CD协议，没有碰撞问题，以全双工方式通信。**
6. 虚拟局域网（VLAN）：每一个VLAN帧都由一个明确的标识符，指明发送这个帧的计算机属于哪一个VLAN。VLAN限制了接收广播信息的计算机数，使得网络上不会出现广播风暴。
7. 虚拟局域网协议允许以太网的帧格式中插入一个4字节的标识符，用来指明发送该帧的计算机属于哪一个VLAN。

## 3.5 高速以太网

* 1999年公布的PPPoE，把PPP协议中的PPP帧再封装到以太网中来传输。**现在的FTTx都要使用PPPoE的方式来接入。**
* 当用户使用ADSL（非对称数字用户线）进行宽带上网时，电脑到ADSL调制解调器之间用RJ-45线进行连接，并且也是用PPPoE弹出的窗口进行拨号的。但是用户电脑发出的以太网帧到了ADSL调制解调器之后，就转换成为ADSL使用的PPP帧。

## 本章重要概念

1. 数据链路层使用的信道主要有点对点信道和广播信道两种。
2. 数据链路层传送的协议数据单元是帧。单个基本准则：封装成帧、透明传输和差错检测。
3. 点对点协议PPP是数据链路层使用最多的一种协议。特点是：简单、不使用序号、同时支持多种网络层协议。
4. PPPoE为宽带上网的主机使用的链路层协议。
5. 局域网的优点：具有广播功能；便于系统的扩展和演变。
6. 共享媒体资源的方法：静态划分信道（各种复用技术）；动态媒体接入控制（随机接入和受控接入）。
7. 计算机与外界局域网的通信要通过通信适配器，又叫网卡。计算机的硬件地址就在适配器的ROM中。
8. 以太网采用的协议是具有冲突检测的载波监听多点接入CSMA/CD协议。协议的要点：**发送前先监听，边发送边监听，一旦发现总线上出现了故障，就立即停止发送。然后按照退避算法等待一定时间再次发送。因此，每一个站在自己发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。**以太网上各站之间平等地竞争以太网信道。
9. 双绞线以太网，物理上是星型网，逻辑上是总线型网。集线器工作在物理层，每个接口仅仅简单转发比特，不进行碰撞检测。
10. 以太网的硬件地址，也就是网络适配器的MAC地址。在网卡的ROM中。
11. 以太网交换机，每个接口与一台主机相连，全双工工作，使一对通信的主机独占通信媒体，无碰撞地传输数据。





# 四、网络层

* 网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。网络在发送数据报时不需要先建立分组。每一个数据报独立发送，与其前后的分组无关。网络层不提供服务质量的承诺。由于网络层，所传送的数据报可能出错、丢失、重复或失序，这就使得网络中的路由器比较简单。
* 采用这种设计思路的好处就是：网络造价大大降低，运行方式灵活，能够适应多种应用。互联网能够发展到今天的规模，充分证明了当初采用这种设计思路的正确性。

## 4.1 网际协议IP

* 与IP协议配套使用的还有三个协议：
  1. **地址解析协议ARP**；
  2. **网际控制报文协议ICMP**；
  3. **网际组管理协议IGMP;**
* 将网络互连起来的设备叫做中间设备：
  1. 物理层使用的中间设备叫做**转发器；**
  2. 数据链路层使用的中间设备叫做**网桥或桥接器**；
  3. 网络层使用的中间设备叫做**路由器；**
  4. 网络层以上使用的中间设备叫做**网关**。用网关连接两个不兼容的系统需要在高层进行协议的转换。
* **当中间设备是转发器或网桥时，这仅仅是把一个网络扩大了，而从网络层的角度看，则仍然是一个网络，一般并不称为网络互连。**
* 使用IP协议就可以让性能各异的网络在网络层上看起来好像是一个统一的网络。互联网可以由多种异构网络互连组成。

### 4.1.1 分类的IP地址

* IP地址的编址方法共经过了三个历史阶段：**分类的IP地址、子网的划分、构成超网。**
* 从IP地址的结构来看，IP地址并不仅仅指明一台主机，而是还指明了主机所连接到的网络。
* 每一个IP地址都由网络号和主机号两部分组成。从这个意义上，IP地址是一种分等级的地址结构。**路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大大减少，从而减少了路由表所占的存储空间以及查找路由表的时间。**
* **实际上IP地址是标志一台主机（或路由器）和一条链路的接口。**当一台主机同时连接到两个网络上时，该主机就必须同时具有两个相应的IP地址，其网络号必须是不同的。**由于一个路由器至少应当连接到两个网络，因此一个路由器至少应当有两个不同的IP地址。**
* **用转发器或网桥连接起来的若干个局域网仍为一个网络。**因为这些局域网都具有同样的网络号。具有不同网络号的局域网必须使用路由器进行互连。
* **在一个局域网上的主机或路由器的IP地址中的网络号必须是一样的。**
* **用网桥（它只在链路层工作）互连的网段仍然是一个局域网，只能有一个网络号。**路由器总是具有两个或两个以上的IP地址。即路由器的每一个接口都由一个不同网络号的IP地址。

### 4.1.2 IP地址与硬件地址

* **物理地址是数据链路层和物理层使用的地址，而IP地址是网络层和以上各层使用的地址，是一种逻辑地址**（IP地址是用软件实现的）。
* 使用IP地址的IP数据报一旦交给了数据链路层，就被封装成MAC帧了。MAC帧在传送时使用的源地址和目的地址都是**硬件地址**，这两个硬件地址都写在MAC帧的首部中。
* IP地址放在IP数据报的首部，硬件地址放在MAC帧的首部。网络层和网络层以上使用的是IP地址，而数据链路层及以下使用的是硬件地址。当IP数据报放入数据链路层的MAC帧中以后，整个的IP数据报就成为MAC帧的数据部分，因而在数据链路层看不见数据报的IP地址。
  1. **在IP层抽象的互联网上只能看到IP数据报。**数据报中间经过的两个路由器的IP地址并不出现在IP数据报的首部中。
  2. 路由器根据目的IP地址的**网络号**进行路由选择。
  3. 在局域网的链路层，只能看见MAC帧。IP数据报被封装在MAC帧中。MAC帧在不同的网络上传送时，其MAC帧首部中的源地址和目的地址要发生变化。
  4. 尽管互连在一起的网络的硬件地址体系各不相同，**但IP层抽象的互联网却屏蔽了下层这些复杂的细节。只要我们在网络层上讨论问题，就能够使用统一的、抽象的IP地址研究主机和主机或路由器之间的通信。**

### 4.1.3 地址解析协议ARP

